## å‰è¨€

ğŸ‘€æœ¬æ–‡ä¸“æ³¨äºwebpackèƒ½åšçš„æ€§èƒ½ä¼˜åŒ–~

æ€§èƒ½ä¼˜åŒ–ä¹Ÿåˆ†ç¯å¢ƒï¼Œç¯å¢ƒä¸åŒå…³æ³¨ç‚¹ä¹Ÿä¸åŒğŸ‘‡

- å¼€å‘ç¯å¢ƒæ€§èƒ½ä¼˜åŒ–ï¼š
  - ä¼˜åŒ–æ‰“åŒ…æ„å»ºé€Ÿåº¦ï¼ˆä»¥ä¸‹ç®€ç§°æ„é€Ÿï¼‰
  - ä¼˜åŒ–ä»£ç è°ƒè¯•ï¼ˆä»¥ä¸‹ç®€ç§°è°ƒè¯•ï¼‰
- ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ä¼˜åŒ–ï¼š
  - ä¼˜åŒ–æ‰“åŒ…æ„å»ºé€Ÿåº¦ï¼ˆä»¥ä¸‹ç®€ç§°æ„é€Ÿï¼‰
  - ä¼˜åŒ–ä»£ç è¿è¡Œçš„æ€§èƒ½ï¼ˆä»¥ä¸‹ç®€ç§°æ€§èƒ½ï¼‰

ä»ç¯‡å¹…è€ƒè™‘ï¼Œåªåˆ—ä¸¾å¿…è¦ä»£ç ã€‚å…·ä½“è¯·çœ‹[è¿™é‡Œ](https://github.com/FE-Huang/StudyNotes/tree/master/6.%20FE%E5%B7%A5%E5%85%B7/Webpack/%E4%BB%A3%E7%A0%81/4.webpack%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96)ã€‚å¯¹ç…§ç€çœ‹æ•ˆæœæ›´ä½³å“¦ï¼Œæœ‰é”™è¯¯çš„åœ°æ–¹éº»çƒ¦å¸®å¿™æŒ‡å‡ºğŸ™ğŸ™

## ã€æ„é€Ÿã€HMR (Hot Module Replacement çƒ­æ¨¡å—æ›¿æ¢/æ¨¡å—çƒ­æ›¿æ¢)

### ç®€ä»‹

ä¸€ä¸ªæ¨¡å—å‘ç”Ÿå˜åŒ–ï¼Œåªä¼šé‡æ–°æ‰“åŒ…è¿™ä¸€ä¸ªæ¨¡å—ï¼ˆè€Œä¸æ˜¯æ‰“åŒ…æ‰€æœ‰æ¨¡å—æˆ–åˆ·æ–°æ•´ä¸ªæ ‡ç­¾é¡µï¼‰ï¼Œæå¤§åœ°æé«˜äº†æ‰“åŒ…æ„å»ºé€Ÿåº¦ã€‚

**æ³¨æ„ï¼š**

- å› ä¸ºHMRæ˜¯åŸºäºdevServerçš„ï¼Œæ‰€ä»¥å®ƒåªèƒ½ç”¨äºå¼€å‘ç¯å¢ƒï¼›
- éœ€è¦å°†package.jsonä¸­çš„browserslistæ³¨é‡Š/åˆ æ‰ã€‚

### é…ç½®1ï¼šå¼€å¯HMR

åªåœ¨*webpacké…ç½®æ–‡ä»¶-devServer*ä¸­æ·»åŠ ï¼š`hot: true`ï¼š

```js
module.exports = {
  devServer: {
    hor: true
  }
}
```

#### ä»£ç 

è¿™é‡Œåªåˆ—å‡ºäº†éƒ¨åˆ†ä»£ç ï¼ˆå¦å¤–è¿˜æœ‰æ ·å¼ã€htmlæœªåˆ—å‡ºï¼‰ï¼Œå»ºè®®å°†å®Œæ•´ä»£ç ä¸‹è½½ä¸‹æ¥çœ‹~

```js
// æ–‡ä»¶ä½ç½®ï¼šwebpack.config.js
const { resolve } = require('path');
const HTMLWebpackPlugin = require('html-webpack-plugin');
// const webpack = require('webpack');

module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build')
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          {
            loader: 'style-loader',
          }, 
          {
            loader: 'css-loader',
          }
        ],
      },
      {
        test: /\.less$/,
        use: ['style-loader', 'css-loader', 'less-loader']
      },
      {
        test: /.(gif|png|jpg)$/,
        loader: 'url-loader',
        options: {
          limit: 8 * 1024,
          esModule: false,
          name: '[hash:8].[ext]',
          outputPath: 'images'
        }
      },
      {
        test: /\.html$/,
        loader: 'html-loader',
        options: {
          esModule: false,
        }
      },
      {
        exclude: /\.(html|css|less|gif|png|jpg|js)$/,
        loader: 'file-loader',
        options: {
          outputPath: 'icon',
          name: '[hash:8].[ext]',
        }
      }
    ]
  },
  plugins: [
    new HTMLWebpackPlugin({
      template: './src/index.html'
    }),
    // new webpack.HotModuleReplacementPlugin() // å®˜ç½‘ä¸Šè¿˜åŠ äº†è¿™å¥
  ],
  mode: 'development',
  devServer: {
    open: true,
    port: 3000,
    contentBase: resolve(__dirname, 'build'),
    compress: true,
    // å¼€å¯HMRåŠŸèƒ½
    // å½“ä¿®æ”¹äº†webpacké…ç½®ï¼Œæ–°é…ç½®è¦æƒ³ç”Ÿæ•ˆï¼Œå¿…é¡»é‡å¯webpackæœåŠ¡
    hot: true
  }
}
```

```js
// æ–‡ä»¶ä½ç½®ï¼šsrc/js/index.js:
import '../styles/iconfont.css';
import '../styles/index.less';
import print from './print';

console.log('index.jsæ–‡ä»¶è¢«åŠ è½½äº†~');

print();

function add(x, y) {
  return x + y;
}

console.log(add(1, 5));
```

```js
// æ–‡ä»¶ä½ç½®ï¼šsrc/js/print.js:
console.log('print.jsè¢«åŠ è½½äº†~');

function print() {
  const content = 'hello print 2';
  console.log(content);
}

export default print;
```

#### æ•ˆæœ

- ä¿®æ”¹æ ·å¼æ–‡ä»¶ï¼šHMR**ç”Ÿæ•ˆ**ï¼ˆå› ä¸º`style-loader`å†…éƒ¨å®ç°äº†HMRï¼‰ï¼›
- ä¿®æ”¹htmlæ–‡ä»¶ï¼šHMR**ä¸ç”Ÿæ•ˆ**ï¼Œä¹Ÿ**ä¸è‡ªåŠ¨åˆ·æ–°**æ ‡ç­¾é¡µï¼›
  - æ³¨æ„ï¼šhtmlé»˜è®¤ä¸èƒ½ä½¿ç”¨HMRï¼Œä¹Ÿç¡®å®ä¸ç”¨åšHMRï¼ˆå› ä¸ºæµè§ˆå™¨ä¸€ä¸ªtabé¡µå§‹ç»ˆåªèƒ½æ‰“å¼€ä¸€ä¸ªhtmlé¡µé¢ï¼Œæˆ–è€…å¯ä»¥ç†è§£ä¸ºå•é¡µåº”ç”¨åªæœ‰ä¸€ä¸ªhtmlï¼Œä¹Ÿå°±æ˜¯è¯´æ‰“å¼€çš„å§‹ç»ˆåªæœ‰ä¸€ä¸ªhtmlæ¨¡å—ï¼‰
  - ä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šä¿®æ”¹è¿™ä¸€ä¸ªhtmlé‡Œçš„ä»£ç ï¼Œhtmlæ–‡ä»¶ä¸èƒ½æ›´æ–°äº†ï¼ˆé™¤éæ‰‹åŠ¨åˆ·æ–°æ•´ä¸ªæ ‡ç­¾é¡µï¼‰
  - å¦‚ä½•è§£å†³ï¼šçœ‹**é…ç½®2**
- jsæ–‡ä»¶ï¼šHMR**ä¸ç”Ÿæ•ˆ**ï¼Œä¹Ÿ**ä¸è‡ªåŠ¨åˆ·æ–°**æ ‡ç­¾é¡µï¼›

### é…ç½®2ï¼šè§£å†³htmlä¸è‡ªåŠ¨åˆ·æ–°

ä¿®æ”¹webpacké…ç½®çš„entry(å…¥å£)ï¼Œå°†htmlæ–‡ä»¶å¼•å…¥ï¼š

```js
module.exports = {
  entry: ['./src/js/index.js', './src/index.html']
}
```

#### ä»£ç 

è¿™é‡Œåªåˆ—å‡ºäº†éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼Œå»ºè®®å°†å®Œæ•´ä»£ç ä¸‹è½½ä¸‹æ¥çœ‹~

```js
// æ–‡ä»¶ä½ç½®ï¼šwebpack.config.js
const { resolve } = require('path');
const HTMLWebpackPlugin = require('html-webpack-plugin');
// const webpack = require('webpack');

module.exports = {
  // åŠ å…¥â€œ./src/index.htmlâ€ï¼šä½¿htmlä¿®æ”¹åå¯ä»¥è‡ªåŠ¨åˆ·æ–°
  entry: ['./src/js/index.js', './src/index.html'],
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build')
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          {
            loader: 'style-loader',
          }, 
          {
            loader: 'css-loader',
          }
        ],
      },
      {
        test: /\.less$/,
        use: ['style-loader', 'css-loader', 'less-loader']
      },
      {
        test: /.(gif|png|jpg)$/,
        loader: 'url-loader',
        options: {
          limit: 8 * 1024,
          esModule: false,
          name: '[hash:8].[ext]',
          outputPath: 'images'
        }
      },
      {
        test: /\.html$/,
        loader: 'html-loader',
        options: {
          esModule: false,
        }
      },
      {
        exclude: /\.(html|css|less|gif|png|jpg|js)$/,
        loader: 'file-loader',
        options: {
          outputPath: 'icon',
          name: '[hash:8].[ext]',
        }
      }
    ]
  },
  plugins: [
    new HTMLWebpackPlugin({
      template: './src/index.html'
    }),
    // new webpack.HotModuleReplacementPlugin() // å®˜ç½‘ä¸Šè¿˜åŠ äº†è¿™å¥
  ],
  mode: 'development',
  devServer: {
    open: true,
    port: 3000,
    contentBase: resolve(__dirname, 'build'),
    compress: true,
    // å¼€å¯HMRåŠŸèƒ½
    // å½“ä¿®æ”¹äº†webpacké…ç½®ï¼Œæ–°é…ç½®è¦æƒ³ç”Ÿæ•ˆï¼Œå¿…é¡»é‡å¯webpackæœåŠ¡
    hot: true
  }
}
```

#### æ•ˆæœ

- ä¿®æ”¹æ ·å¼æ–‡ä»¶ï¼šHMRç”Ÿæ•ˆï¼ˆå› ä¸º`style-loader`å†…éƒ¨å®ç°äº†HMRï¼‰ï¼›
- ä¿®æ”¹htmlæ–‡ä»¶ï¼šHMRä¸ç”Ÿæ•ˆï¼Œä½†ä¼šè‡ªåŠ¨åˆ·æ–°æ•´ä¸ªæ ‡ç­¾é¡µï¼›
- jsæ–‡ä»¶ï¼šHMRä¸ç”Ÿæ•ˆï¼Œä¹Ÿä¸è‡ªåŠ¨åˆ·æ–°æ ‡ç­¾é¡µï¼›

### é…ç½®3ï¼šè§£å†³JSçš„HMRä¸ç”Ÿæ•ˆ

éœ€åœ¨å…¥å£æ–‡ä»¶ä¸­åŠ é…ç½®ï¼ˆè§ä»£ç ï¼‰ã€‚

#### ä»£ç 

åœ¨å…¥å£æ–‡ä»¶â€œsrc/js/index.jsâ€ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œå…¶ä»–é…ç½®ä¸å˜ï¼š

```js
if (module.hot) {
  // ä¸€æ—¦ module.hot ä¸ºtrueï¼Œè¯´æ˜å¼€å¯äº†HMRåŠŸèƒ½ã€‚ --> è®©HMRåŠŸèƒ½ä»£ç ç”Ÿæ•ˆ
  module.hot.accept('./print.js', function() {
    // æ–¹æ³•ä¼šç›‘å¬ print.js æ–‡ä»¶çš„å˜åŒ–ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œå…¶ä»–æ¨¡å—ä¸ä¼šé‡æ–°æ‰“åŒ…æ„å»ºã€‚
    // ä¼šæ‰§è¡Œåé¢çš„å›è°ƒå‡½æ•°
    print();
  });
}
```

#### æ•ˆæœ

- ä¿®æ”¹æ ·å¼æ–‡ä»¶ï¼šHMRç”Ÿæ•ˆï¼ˆå› ä¸º`style-loader`å†…éƒ¨å®ç°äº†HMRï¼‰ï¼›
- ä¿®æ”¹htmlæ–‡ä»¶ï¼šHMRä¸ç”Ÿæ•ˆï¼Œä½†ä¼šè‡ªåŠ¨åˆ·æ–°æ•´ä¸ªæ ‡ç­¾é¡µï¼ˆhtmlæ–‡ä»¶ä¸éœ€è¦HMRï¼‰ï¼›
- jsæ–‡ä»¶ï¼šHMRç”Ÿæ•ˆï¼ˆä¿®æ”¹print.jsï¼ŒHMRç”Ÿæ•ˆï¼›ä¿®æ”¹index.jsï¼Œè‡ªåŠ¨åˆ·æ–°æ•´ä¸ªæ ‡ç­¾é¡µï¼‰ï¼›

### HMRå°ç»“

å¼€å¯HMRï¼ˆwebpacké…ç½®ä¸­æ·»åŠ `hot: true`ï¼‰ä¹‹åï¼š

- æ ·å¼æ–‡ä»¶ï¼šHMR**ç”Ÿæ•ˆ**ï¼ˆ`style-loader`å†…éƒ¨å®ç°äº†HMRï¼Œæ— éœ€å…¶ä»–é…ç½®ï¼‰ï¼›
- htmlæ–‡ä»¶ï¼šHMR**ä¸ç”Ÿæ•ˆ**ï¼ˆä¹Ÿä¸éœ€è¦ç”Ÿæ•ˆï¼‰ï¼Œä¹Ÿ**ä¸è‡ªåŠ¨åˆ·æ–°**æ ‡ç­¾é¡µï¼š
  - htmlä¸éœ€è¦HMRï¼šhtmlé»˜è®¤ä¸èƒ½ä½¿ç”¨HMRï¼Œä¹Ÿç¡®å®ä¸ç”¨åšHMRï¼ˆå› ä¸ºæµè§ˆå™¨ä¸€ä¸ªtabé¡µå§‹ç»ˆåªèƒ½æ‰“å¼€ä¸€ä¸ªhtmlé¡µé¢ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå•é¡µåº”ç”¨ï¼‰ã€‚
  - é—®é¢˜ - æ ‡ç­¾é¡µä¸è‡ªåŠ¨åˆ·æ–°ï¼š
    - å¦‚ä½•è§£å†³ï¼šä¿®æ”¹entryå…¥å£ï¼Œå°†htmlæ–‡ä»¶å¼•å…¥ï¼ˆ`entry: ['./src/js/index.js', './src/index.html']`ï¼‰
- jsæ–‡ä»¶ï¼šHMR**é»˜è®¤ä¸ç”Ÿæ•ˆ**ï¼ˆæœ‰ä¿®æ”¹æ—¶ä¼šåˆ·æ–°æ•´ä¸ªæ ‡ç­¾é¡µï¼‰ã€‚è¦ä½¿ç”¨éœ€è¦ä¿®æ”¹jsä»£ç ï¼ˆæ·»åŠ æ”¯æŒHMRåŠŸèƒ½çš„ä»£ç ï¼‰ï¼š
  - æ³¨æ„ï¼šHMRåŠŸèƒ½å¯¹jsçš„å¤„ç†ï¼Œåªèƒ½å¤„ç†éå…¥å£jsæ–‡ä»¶ï¼›
  - ä»£ç ï¼ˆåœ¨å…¥å£jsä¸­æ·»åŠ ï¼‰ï¼š

    ```js
    if (module.hot) {
      // ä¸€æ—¦ module.hot ä¸ºtrueï¼Œè¯´æ˜å¼€å¯äº†HMRåŠŸèƒ½ã€‚ --> è®©HMRåŠŸèƒ½ä»£ç ç”Ÿæ•ˆ
      module.hot.accept('./print.js', function() {
        // æ–¹æ³•ä¼šç›‘å¬ print.js æ–‡ä»¶çš„å˜åŒ–ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œå…¶ä»–æ¨¡å—ä¸ä¼šé‡æ–°æ‰“åŒ…æ„å»ºã€‚
        // ä¼šæ‰§è¡Œåé¢çš„å›è°ƒå‡½æ•°
        print();
      });
    }
    ```

  - æ•ˆæœï¼šä¿®æ”¹print.jsï¼ŒHMRç”Ÿæ•ˆï¼›ä¿®æ”¹index.jsï¼Œè‡ªåŠ¨åˆ·æ–°æ•´ä¸ªæ ‡ç­¾é¡µ

## ã€è°ƒè¯•ã€source-map

### ç®€ä»‹

æ˜¯â€œæºä»£ç åˆ°æ„å»ºåä»£ç â€çš„**æ˜ å°„**ã€‚å¦‚æœæ„å»ºåä»£ç æŠ¥é”™ï¼Œå¯ä»¥é€šè¿‡æ˜ å°„å…³ç³»è¿½è¸ªæºä»£ç ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸­ä¹Ÿä¼šæŒ‡å‡º**æŠ¥é”™åŸå› **ã€**æºä»£ç çš„å…·ä½“ä½ç½®ï¼ˆæŸæ–‡ä»¶çš„æŸè¡ŒæŸåˆ—ï¼‰**ã€‚

![](https://gitee.com/ahuang6027/blog-images/raw/master/images/source-map-æŠ¥é”™ä¿¡æ¯.png)

ğŸ¤”å¯ä»¥çœ‹å‡ºï¼Œsource-mapæœ‰ä¸‰ä¸ªè¦ç‚¹ï¼š**æ˜ å°„å…³ç³»**ã€**æŠ¥é”™åŸå› **ã€**å…·ä½“ä½ç½®ï¼ˆæŸæ–‡ä»¶çš„æŸè¡ŒæŸåˆ—ï¼‰**ã€‚

### é…ç½®

```js
module.exports = {
  devtool: 'evel-source-map'
}
```

### ç±»å‹

æ ¹æ®ä¸¤ä¸ªè¦ç‚¹åå‘çš„ä¸åŒï¼Œsource-mapå…¶å®æœ‰ä¸åŒçš„ç±»å‹ğŸ‘‡

`[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map`

#### æ˜ å°„å…³ç³»

è¿™ç§æ˜ å°„å…³ç³»ä¸€èˆ¬æœ‰ä¸‰ç§å­˜æ”¾ä½ç½®ï¼š

- å½“å‰æ–‡ä»¶æœ«å°¾ï¼ˆæˆ‘æŠŠå®ƒç§°ä¸ºâ€œå†…è”â€ï¼‰ï¼›
- å½“å‰æ–‡ä»¶å†…æ¯å—ä»£ç æœ«å°¾ï¼ˆæˆ‘ç§°ä¸ºâ€œè¡Œå†…â€ï¼‰ï¼›
- å•ç‹¬çš„æ–‡ä»¶ï¼ˆæˆ‘ç§°ä¸ºâ€œå¤–éƒ¨â€ï¼‰ã€‚

#### ä¸åŒçš„source-mapâœ”ï¸âŒ

| ç±»å‹ | æ˜ å°„å…³ç³» | æŠ¥é”™åŸå›  | å¯è¿½è¸ªæºä»£ç  | å…·ä½“æ–‡ä»¶ | å…·ä½“è¡Œ | å…·ä½“åˆ— | æè¿° |
| :-----: | :---: | :--: | :--: | :--: | :--: | :--: | :--: |
| source-map | å¤–éƒ¨ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | é”™è¯¯ä»£ç å‡†ç¡®ä¿¡æ¯ã€å¯è¿½è¸ªæºä»£ç çš„é”™è¯¯ä½ç½® |
| inline-source-map | å†…è” | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | é”™è¯¯ä»£ç å‡†ç¡®ä¿¡æ¯ã€å¯è¿½è¸ªæºä»£ç çš„é”™è¯¯ä½ç½® |
| hidden-source-map | å¤–éƒ¨ | âœ”ï¸ | âŒ | âœ”ï¸ | âŒ | âŒ | æ§åˆ¶å°åªæç¤ºæºä»£ç çš„é”™è¯¯ä½ç½®ï¼Œä¸èƒ½è¿½è¸ªæºä»£ç é”™è¯¯ï¼ˆç‚¹è¿›å»æ˜¯æ‰“åŒ…åçš„æ–‡ä»¶ï¼‰ |
| eval-source-map | è¡Œå†… | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | é”™è¯¯ä»£ç å‡†ç¡®ä¿¡æ¯ã€å¯è¿½è¸ªæºä»£ç çš„é”™è¯¯ä½ç½® |
| nosources-source-map | å¤–éƒ¨ | âœ”ï¸ | âŒ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | æ§åˆ¶å°çš„æŠ¥é”™ä¿¡æ¯å†™äº†å…·ä½“æ–‡ä»¶ã€è¡Œã€åˆ—ï¼Œä½†ç‚¹è¿›å»æ‰¾ä¸åˆ°å¯¹åº”æ–‡ä»¶ |
| cheap-source-map | å¤–éƒ¨ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âŒ | é”™è¯¯ä»£ç å‡†ç¡®ä¿¡æ¯ã€å¯è¿½è¸ªæºä»£ç çš„é”™è¯¯ä½ç½® |
| cheap-module-source-map | å¤–éƒ¨ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âŒ | â€œmoduleâ€ä¼šå°†loaderçš„source mapåŠ å…¥ï¼ˆæ‰€ä»¥è°ƒè¯•æ›´å‹å¥½ï¼‰ |

#### å¼€å‘/ç”Ÿäº§æœ€ä¼˜è§£

- å¼€å‘ï¼šæ„å»ºé€Ÿåº¦å¿«ã€è°ƒè¯•æ›´å‹å¥½
  - æ„å»ºé€Ÿåº¦ï¼ˆå¿« --> æ…¢ï¼ševal > inline > cheap > ...ï¼‰ï¼š
    - eval-cheap-source-mapï¼ˆæœ€å¿«ï¼‰
    - eval-source-mapï¼ˆç¬¬äºŒå—ï¼‰
  - è°ƒè¯•å‹å¥½ï¼š
    - source-mapï¼ˆæœ€å‹å¥½ï¼‰
    - cheap-module-source-mapï¼ˆç¬¬äºŒï¼‰
    - cheap-source-mapï¼ˆç¬¬ä¸‰ï¼‰
  - ã€å°ç»“ã€‘å¼€å‘ç¯å¢ƒæœ€ä¼˜é€‰ï¼š
    - eval-source-mapï¼ˆå…¼é¡¾æ„å»ºé€Ÿåº¦å’Œè°ƒè¯•ï¼Œä½†åè°ƒè¯•ï¼‰
    - æˆ–eval-cheap-module-souce-mapï¼ˆå…¼é¡¾æ„å»ºé€Ÿåº¦å’Œè°ƒè¯•ï¼Œä½†åæ„å»ºï¼‰
- ç”Ÿäº§ï¼šæ˜¯å¦éšè—æºä»£ç ã€æ˜¯å¦éœ€è¦è°ƒè¯•å‹å¥½
  - éšè—æºä»£ç 
    - nosources-source-mapï¼šå…¨éƒ¨éšè—;
    - hidden-source-mapï¼šåªéšè—æºä»£ç ï¼Œä¼šæç¤ºæ„å»ºåä»£ç é”™è¯¯ä¿¡æ¯ã€‚
  - è°ƒè¯•æ›´å‹å¥½ï¼š
    - source-map
    - cheap-module-souce-map
  - ã€æ³¨æ„ã€‘å†…è”ä¼šè®©ä»£ç ä½“ç§¯å˜å¤§ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸ç”¨å†…è”

## ã€æ„é€Ÿã€oneOf

### ç®€ä»‹

é…ç½®åï¼š
ä¸€ä¸ªæ–‡ä»¶åœ¨æ„å»ºæ—¶ï¼Œä¼šåŒ¹é…oneOfæ•°ç»„é‡Œå¤´æŸä¸€ä¸ªloaderï¼Œç”¨äºä¼˜åŒ–ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…æ„å»ºé€Ÿåº¦ã€‚  
ï¼ˆä¸é…ç½®çš„è¯ï¼Œä¸€ä¸ªæ–‡ä»¶ä¼šæŒ¨ä¸ªå»åŒ¹é…loaderã€‚åŒ¹é…åˆ°ä¸€ä¸ªåä¹Ÿä¸ä¼šåœæ­¢ï¼Œå› ä¸ºä¸ç¡®å®šæ˜¯å¦æœ‰å¤šä¸ªloaderå‘½ä¸­ï¼‰

**æ³¨æ„ï¼š**oneOfæ•°ç»„é‡Œä¸èƒ½æœ‰ä¸¤ä¸ªloaderé…ç½®å¤„ç†åŒä¸€ç±»å‹çš„æ–‡ä»¶ã€‚å¦‚æœä¸€ä¸ªç±»å‹æœ‰å¤šä¸ªloaderï¼Œå¯åœ¨oneOfä¸­ä¿ç•™ä¸€ä¸ªï¼Œå°†å…¶ä½™çš„æåˆ°å¤–å±‚ã€‚

### é…ç½®

```js
const { resolve } = require('path');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

process.env.NODE_ENV = 'production';

const commonCssLoader = [
  MiniCssExtractPlugin.loader,
  'css-loader',
  {
    loader: 'postcss-loader',
    options: {}
  }
];

module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build')
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        enforce: 'pre', // ä¼˜å…ˆæ‰§è¡Œ
        loader: 'eslint-loader',
        options: {}
      },
      {
        // ä»¥ä¸‹loaderåªä¼šåŒ¹é…ä¸€ä¸ª
        // æ³¨æ„ï¼šä¸èƒ½æœ‰ä¸¤ä¸ªé…ç½®å¤„ç†åŒä¸€ç§ç±»å‹æ–‡ä»¶
        oneOf: [
          {
            test: /\.css$/,
            use: [...commonCssLoader]
          },
          {
            test: /\.less$/,
            use: [ ...commonCssLoader, 'less-loader' ]
          },
          {
            test: /\.js$/,
            exclude: /node_modules/,
            loader: 'babel-loader',
            options: {}
          },
          {
            test: /\.(jpg|png|gif)$/,
            loader: 'url-loader',
            options: {}
          },
          {
            test: /\.html$/,
            loader: 'html-loader',
            options: {}
          },
          {
            exclude: /\.(js|html|css|less|jpg|png|gif)$/,
            loader: 'file-loader',
            options: {}
          }
        ]
      }
    ]
  },
  plugins: [],
  mode: 'production'
}
```

## ç¼“å­˜

### ç®€ä»‹

ä»æ„å»ºé€Ÿåº¦å’Œéƒ¨ç½²è¿è¡Œä¸¤ä¸ªæ–¹é¢è€ƒè™‘ï¼š

- webpackæ‰“åŒ…æ„å»ºæ—¶ï¼Œåˆ©ç”¨ç¼“å­˜ä½¿é€Ÿåº¦å˜å¿«ï¼ˆbabelç¼“å­˜ï¼‰ï¼›
- é¡¹ç›®éƒ¨ç½²è¿è¡Œæ—¶ï¼Œåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ä½¿ç½‘é¡µåŠ è½½æ›´å¿«ã€‚webpackæ‰“åŒ…æ—¶ï¼Œåœ¨è¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶åæœ«å°¾åŠ ä¸Šhashå€¼ï¼Œè§£å†³ç¼“å­˜é€ æˆçš„ä»£ç å¯èƒ½ä¸ç”Ÿæ•ˆçš„é—®é¢˜ï¼ˆæ–‡ä»¶èµ„æºç¼“å­˜ï¼‰ã€‚

### ã€æ„é€Ÿã€Babelç¼“å­˜

#### é…ç½®

  ä¿®æ”¹`babel-loader`çš„é…ç½®ï¼Œæ·»åŠ `cacheDirectory: true`

  ```js
  module.exports = {
    module: {
      rules: [
        {
          test: /\.js$/,
          exclude: /node_modules/,
          loader: 'babel-loader',
          options: {
            presets: [],
            // å¼€å¯babelç¼“å­˜
            // ç¬¬äºŒæ¬¡æ„å»ºæ—¶ï¼Œä¼šè¯»å–ä¹‹å‰çš„ç¼“å­˜
            cacheDirectory: true
          }
        }
      ]
    }
  }
  ```

#### ä½œç”¨

ç¬¬äºŒæ¬¡æ„å»ºæ—¶ï¼Œä¼šè¯»å–ä¹‹å‰çš„ç¼“å­˜ï¼Œä»è€Œä½¿ç¬¬äºŒæ¬¡æ‰“åŒ…æ„å»ºé€Ÿåº¦æ›´å¿«ã€‚

### ã€æ€§èƒ½ã€æ–‡ä»¶èµ„æºç¼“å­˜

#### é…ç½®

åœ¨æ‰€æœ‰å¯ä»¥ç»™è¾“å‡ºæ–‡ä»¶å‘½åçš„åœ°æ–¹åŠ ä¸Š`[hash/contenthash/chunkhash:10]`ï¼ˆæ¯”å¦‚ï¼šå°†output.filenameä¿®æ”¹ä¸º`js/built.[hash:10].js`ï¼‰

```js
const { resolve } = require('path');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

process.env.NODE_ENV = 'production';

module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.[contenthash:10].js',
    path: resolve(__dirname, 'build')
  },
  module: {
    rules: [
      {
        // ä»¥ä¸‹loaderåªä¼šåŒ¹é…ä¸€ä¸ª
        // æ³¨æ„ï¼šä¸èƒ½æœ‰ä¸¤ä¸ªé…ç½®å¤„ç†åŒä¸€ç§ç±»å‹æ–‡ä»¶
        oneOf: [
          {
            test: /\.js$/,
            exclude: /node_modules/,
            loader: 'babel-loader',
            options: {
              presets: [],
              // å¼€å¯babelç¼“å­˜
              // ç¬¬äºŒæ¬¡æ„å»ºæ—¶ï¼Œä¼šè¯»å–ä¹‹å‰çš„ç¼“å­˜
              cacheDirectory: true
            }
          },
          {
            test: /\.(jpg|png|gif)$/,
            loader: 'url-loader',
            options: {
              limit: 8 * 1024,
              name: '[contenthash:10].[ext]',
              outputPath: 'images',
              esModule: false
            }
          },]
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'css/built.[contenthash:10].css'
    }),
  ],
  mode: 'production',
  devtool: 'source-map'
}
```

#### hash/chunkhash/contenthash

- hashï¼šæ¯æ¬¡webpackæ„å»ºæ—¶ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„hashå€¼ï¼›
  - é—®é¢˜ï¼šå› ä¸ºjså’Œcssä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªhashå€¼ã€‚ä½¿ç”¨[hash:10]é‡æ–°æ‰“åŒ…åï¼Œä¼šå¯¼è‡´æ‰€æœ‰çš„ç¼“å­˜éƒ½å¤±æ•ˆäº†ï¼ˆå› ä¸ºjså’Œcssçš„æ–‡ä»¶åéƒ½å˜äº†ï¼Œä½†å¯èƒ½æ­¤æ—¶åªæ”¹åŠ¨äº†ä¸€ä¸ªæ–‡ä»¶ï¼‰
- chunkhashï¼šæ ¹æ®chunkç”Ÿæˆçš„hashå€¼ã€‚å¦‚æœæ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶æ¥æºäºä¸€ä¸ªchunkï¼Œé‚£ä¹ˆhashå€¼å°±ä¸€æ ·ã€‚
  - é—®é¢˜ï¼šåŒä¸€ä¸ªchunkï¼Œjså’Œcssä½¿ç”¨çš„hashå€¼è¿˜æ˜¯åŒä¸€ä¸ªã€‚ä¾ç„¶å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜å¤±æ•ˆï¼ŒåŸå› åœºæ™¯åŒä¸Šã€‚
- contenthashï¼šæ ¹æ®æ–‡ä»¶çš„å†…å®¹ç”Ÿæˆhashå€¼ã€‚
  - åªè¦æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œhashå€¼å°±ä¼šæ”¹å˜ï¼ˆå†…å®¹ä¸å˜ï¼Œhashå€¼ä¹Ÿä¸å˜ï¼‰ï¼›
  - è¿™æ ·ï¼Œä¸åŒæ–‡ä»¶çš„hashå€¼ä¸€å®šä¸åŒï¼›
  - å®Œç¾è§£å†³äº†ä¸Šè¾¹çš„é—®é¢˜ã€‚

**å°ç»“ï¼š** æœ€ä¼˜è§£æ˜¯**contenthash**ã€‚

## ã€æ€§èƒ½ã€tree shakingï¼ˆæ ‘æ‘‡ï¼‰

### ç®€ä»‹

>æƒ³è±¡æœ‰æ£µæ ‘ï¼š  
>æ ‘ä¸Šæœ‰ç»¿è‰²å’Œæ¯é»„çš„å¶å­ï¼Œä¸ºäº†åªä¿ç•™ç»¿è‰²çš„å¶å­ï¼Œæœ‰ä¸ªäººå°±å»æ‘‡æ™ƒè¿™æ£µæ ‘ï¼Œå°†æ¯é»„å¶ç‰‡æ‘‡è½ä¸‹æ¥ã€‚

ç±»æ¯”ä¸Šé¢é‚£æ£µæ ‘ï¼Œwebpackä¸­çš„tree shakingå³**å»é™¤æ²¡æœ‰ç”¨è¿‡çš„ä»£ç ï¼Œå‡å°æ‰“åŒ…åä»£ç ä½“ç§¯**ã€‚

### é…ç½®

- é¦–å…ˆï¼Œå†™ä»£ç æ—¶å¿…é¡»ä½¿ç”¨ES6æ¨¡å—åŒ–ï¼›
- å¼€å¯`production`æ¨¡å¼ï¼ˆæˆ–å¼•ç”¨ä¸€ä¸ªèƒ½å¤Ÿåˆ é™¤æœªå¼•ç”¨ä»£ç çš„å‹ç¼©å·¥å…·ï¼Œæ¯”å¦‚`UglifyJSPlugin`ï¼‰ï¼›
- é¿å…åªimportå´æœªè°ƒç”¨çš„æ–‡ä»¶ï¼ˆç±»ä¼¼äºcssã€@babel/polyfillè¿™ç§ï¼‰è¢«å¹²æ‰ï¼Œè¿˜éœ€è®¾ç½®package.jsonçš„`sideEffects`ï¼š
  - `"sideEffects": false`ï¼šæ‰€æœ‰ä»£ç éƒ½æ²¡æœ‰å‰¯ä½œç”¨ï¼ˆéƒ½å¯ä»¥è¢«æ‘‡æ‰ï¼Œå¯èƒ½ä¼šå¹²æ‰cssã€@babel/polyfillï¼‰ï¼›
  - `"sideEffects": ["*.css", "*.less"]`ï¼šç›¸å½“äºæ’é™¤äº†"*.css"ã€ "*.less"ä¸¤ç§æ–‡ä»¶ã€‚

## ã€æ€§èƒ½ã€code split

### ç®€ä»‹

### å¤šå…¥å£ï¼ˆdemo1ï¼‰

![](https://gitee.com/ahuang6027/blog-images/raw/master/images/code-split-demo1.png)

### å¤šå…¥å£ + é…ç½®splitChunks

![](https://gitee.com/ahuang6027/blog-images/raw/master/images/code-split-demo2-ä¸å¼•å…¥jq.png)
![](https://gitee.com/ahuang6027/blog-images/raw/master/images/code-split-demo2-å¼•å…¥jq.png)

### å•å…¥å£ + é…ç½®splitChunks + åŠ¨æ€import

![](https://gitee.com/ahuang6027/blog-images/raw/master/images/code-split-demo3.png)

## æ‡’åŠ è½½å’Œé¢„åŠ è½½

![](https://gitee.com/ahuang6027/blog-images/raw/master/images/æ‡’åŠ è½½.png)
![](https://gitee.com/ahuang6027/blog-images/raw/master/images/é¢„åŠ è½½.png)
