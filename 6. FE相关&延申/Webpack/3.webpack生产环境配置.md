## 1. å‰è¨€

>ğŸ“–å›é¡¾ï¼š  
>ä¸Šä¸€ç¯‡æ–‡ç« [webpackå¼€å‘ç¯å¢ƒé…ç½®](https://www.yuque.com/otv29s/huanghuang/ylusyd)ä»æ–‡ä»¶ç±»å‹çš„è§’åº¦å‡ºå‘ï¼Œç®€å•ä»‹ç»äº†æ ·å¼ã€htmlã€å›¾ç‰‡ç­‰èµ„æºè¦å¦‚ä½•æ‰“åŒ…ï¼Œè¿˜ç®€å•é…ç½®äº†ä¸€ä¸‹å¼€å‘æœåŠ¡å™¨devServerï¼Œæ²¡å°è±¡çš„è¯å¯ä»¥å›å»å¤ä¹ ä¸€ä¸‹å“¦~

ä¸ä¸Šä¸€ç¯‡æ–‡ç« ä¸åŒçš„æ˜¯ï¼Œæœ¬æ–‡ä¼šä»æ–‡ä»¶å†…å®¹çš„è§’åº¦å‡ºå‘ï¼Œä»‹ç»æ ·å¼ã€htmlã€jsçš„**æ–‡ä»¶æå–**ã€**å…¼å®¹æ€§å¤„ç†**å’Œ**å‹ç¼©**ã€‚å¯èƒ½ä¸ä¼šæ·±å…¥ä»‹ç»æ¯ä¸ªé…ç½®é¡¹ï¼Œæœ‰éœ€è¦å¯ä»¥æŒ¨ä¸ªå»æŸ¥é˜…å®˜æ–¹æ–‡æ¡£~

å¦å¤–ï¼Œä»ç¯‡å¹…è€ƒè™‘ï¼Œåªä¼šåˆ—å‡ºå¿…è¦çš„ä»£ç ï¼Œå®Œæ•´çš„ä»£ç åœ¨[è¿™é‡Œ](https://github.com/FE-Huang/StudyNotes/tree/master/6.%20FE%E5%B7%A5%E5%85%B7/Webpack/%E4%BB%A3%E7%A0%81/3.webpack%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE)

## 2. cssæ–‡ä»¶

### 2.1. æå–cssæˆå•ç‹¬æ–‡ä»¶

#### ä½¿ç”¨çš„pluginï¼š`mini-css-extract-plugin`

#### æ€è·¯

é¦–å…ˆï¼Œåœ¨ä¸Šä¸€ç¯‡å¼€å‘ç¯å¢ƒä¸­ï¼Œwebpackçš„é…ç½®æ˜¯è¿™æ ·çš„ï¼š

- css-loaderï¼šå°†cssæ–‡ä»¶è½¬æ¢æˆcommonjsæ¨¡å—åŠ è½½åˆ°jsä¸­ï¼Œcssä»£ç è¢«è½¬æ¢æˆäº†æ ·å¼å­—ç¬¦ä¸²ã€‚ï¼ˆè½¬æ¢åå¾—åˆ°çš„commonjsæ¨¡å—å¯ä»¥ç†è§£ä¸ºï¼šç”¨jsç»™å…ƒç´ åŠ¨æ€æ·»åŠ æ ·å¼çš„é‚£ç§ä»£ç ï¼‰ï¼›
- style-loaderï¼šåˆ›å»ºstyleæ ‡ç­¾ï¼Œå°†css-loaderç”Ÿæˆçš„æ ·å¼èµ„æºæ’å…¥è¿›å»ï¼Œæ·»åŠ åˆ°headä¸­ï¼Œä½¿æ ·å¼ç”Ÿæ•ˆã€‚

```js
module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'built.js',
    path: resolve(__dirname, 'dist')
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          'style-loader', // åˆ›å»ºstyleæ ‡ç­¾ï¼Œå°†'css-loader'æ•´åˆåˆ°jsä¸­çš„æ ·å¼å­—ç¬¦ä¸²æ”¾åˆ°styleæ ‡ç­¾ä¸­ã€‚
          'css-loader' // å°†cssæ–‡ä»¶è½¬æ¢æˆcommonjsæ¨¡å—åŠ è½½åˆ°jsä¸­ï¼Œcssä»£ç è¢«è½¬æ¢æˆäº†æ ·å¼å­—ç¬¦ä¸²ã€‚
        ]
      }
    ]
  },
  plugins: [],
  mode: 'development'
}
```

ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³æå–cssæˆä¸€ä¸ªæ–‡ä»¶ã€‚æ˜¾ç„¶ï¼Œä¸å†éœ€è¦`style-loader`å°†æ ·å¼ä»£ç å¡è¿›`<style></style>`æ ‡ç­¾äº†ã€‚éœ€è¦çš„æ˜¯å¦å¤–ä¸€ä¸ªloaderæˆ–pluginï¼Œç”¨äºç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œå¹¶å°†æ ·å¼ä»£ç å¡è¿›å»ã€‚

#### webpacké…ç½®

```js
const { resolve }  = require('path');
const HTMLWebpackPlugin = require('html-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build')
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          // 'style-loader', // åˆ›å»ºstyleæ ‡ç­¾ï¼Œå°†'css-loader'æ•´åˆåˆ°jsä¸­çš„æ ·å¼æ”¾åˆ°styleæ ‡ç­¾ä¸­

          // ç”¨è¿™ä¸ªloaderå–ä»£style-loaderï¼Œå› ä¸ºæƒ³å°†csså•ç‹¬è¾“å‡ºä¸ºä¸€ä¸ªæ–‡ä»¶
          MiniCssExtractPlugin.loader, // ä½œç”¨ï¼šæå–jsä¸­çš„cssæˆå•ç‹¬æ–‡ä»¶

          'css-loader' // å°†cssæ–‡ä»¶æ•´åˆåˆ°jsä¸­
        ]
      }
    ]
  },
  plugins: [
    new HTMLWebpackPlugin({
      template: './src/index.html'
    }),
    new MiniCssExtractPlugin({
      // å¯¹è¾“å‡ºçš„cssæ–‡ä»¶é‡å‘½å
      filename: 'css/built.css'
    })
  ],
  mode: 'development'
}
```

### 2.2. csså…¼å®¹æ€§å¤„ç†

#### ä½¿ç”¨çš„loaderï¼š`postcss-loader`

éœ€è¦ä¸‹è½½ä¸¤ä¸ªåŒ…ï¼š`postcss-loader`ã€`postcss-preset-env`

- `postcss-loader`ï¼šæ ¹æ®nodeç¯å¢ƒå˜é‡ç”Ÿæˆå¯¹åº”ç¯å¢ƒçš„å…¼å®¹æ€§ä»£ç ï¼›
  - è®¾ç½®ç¯å¢ƒå˜é‡ï¼š`process.env.NODE_ENV = 'development'`;
  - å¦‚æœä¸æ‰‹åŠ¨è®¾ç½®nodeç¯å¢ƒå˜é‡ï¼Œé»˜è®¤ä¸º"production"ã€‚
- `postcss-preset-env`ï¼šå¸®åŠ©`postcss-loader`æ‰¾åˆ°package.jsonä¸­browserslistçš„é…ç½®ï¼Œå¤§æ¦‚é•¿ä¸‹è¾¹è¿™æ ·ï¼š

  ```json
    "browserslist": {
      // å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œå¯¹åº”çš„æ˜¯nodeçš„ç¯å¢ƒå˜é‡ï¼ˆéwebpack.config.jsé…ç½®çš„modeï¼‰ï¼šprocess.env.NODE_ENV = development
      "development": [
        "last 1 chrome version", //chromeæœ€æ–°çš„ä¸€ä¸ªç‰ˆæœ¬
        "last 1 firefox version",
        "last 1 safari version"
      ],
      "production": [
        ">0.2%", // å…¼å®¹å¸‚é¢ä¸Šï¼ˆä½¿ç”¨äººæ•°ï¼Ÿå¾…æŸ¥ï¼‰æœ€é å‰çš„99.8%çš„æµè§ˆå™¨
        "not dead", // å…¼å®¹éæ­»äº¡çš„æµè§ˆå™¨
        "not op_mini all" // å…¼å®¹éopen miniæµè§ˆå™¨
      ]
    }
  ```

#### æ€è·¯

å›é¡¾ä¸€ä¸‹2.1ä¸­cssæ–‡ä»¶çš„æ‰“åŒ…æµç¨‹ï¼šå…ˆç”¨ `css-loader`å°†æ ·å¼åŠ è½½åˆ°jsä¸­ï¼›å†ç”¨`MiniCssExtractPlugin.loader`å°†æ ·å¼æ‰“åŒ…è¿›å•ç‹¬çš„æ–‡ä»¶ã€‚

è¿›è¡Œå…¼å®¹æ€§å¤„ç†çš„è¯ï¼Œæˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œç›¸å¯¹ç®€å•çš„å¤„ç†é¡ºåºå¯èƒ½æœ‰ä¸¤ç§ï¼šåœ¨`css-loader`å‰æˆ–`MiniCssExtractPlugin.loader`åã€‚
è¿™é‡Œé€‰æ‹©åœ¨`css-loader`å‰ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªé¡ºåºæˆ‘ç°åœ¨è¿˜æ²¡æœ‰ææ¸…æ¥šï¼ŒçŸ¥é“çš„ä¼™ä¼´å¯ä»¥åˆ†äº«ä¸€ä¸‹ğŸ™ğŸ™

#### webpacké…ç½®

1ï¼‰å…ˆè¦åœ¨package.jsonä¸­é…ç½®å­—æ®µ`browserslist`ï¼š

```json{
  "name": "webpack-study",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "browserslist": {
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ],
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ]
  },
}
```

2ï¼‰webpacké…ç½®ï¼š

```js
const { resolve } = require('path');
const HTMLWebpackPlugin = require('html-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

// é…ç½®nodeçš„ç¯å¢ƒå˜é‡
process.env.NODE_ENV = 'development';

module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build')
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                ident: 'post-css',
                plugins: [
                  'postcss-preset-env'
                ]
              }
            }
          }
        ]
      }
    ]
  },
  plugins: [
    new HTMLWebpackPlugin({
      template: './src/index.html'
    }),
    new MiniCssExtractPlugin({
      filename: 'css/built.css'
    })
  ],
  mode: 'development'
}
```

### 2.3. å‹ç¼©css

#### ä½¿ç”¨çš„pluginï¼š`optimize-css-assets-webpack-plugin`

#### webpacké…ç½®

```js
const { resolve } = require('path');
const HTMLWebpackPlugin = require('html-webpack-plugin');
const MiniCSSExtractPlugin = require('mini-css-extract-plugin');
const OptimizeCSSAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin');

// é…ç½®nodeçš„ç¯å¢ƒå˜é‡ - csså…¼å®¹æ€§å¤„ç†æ—¶ä½¿ç”¨
// process.env.NODE_ENV = 'development';

module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build')
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          MiniCSSExtractPlugin.loader,
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                ident: 'postcss',
                plugins: [
                  'postcss-preset-env'
                ]
              }
            }
          }
        ]
      }
    ]
  },
  plugins: [
    new HTMLWebpackPlugin({
      template: './src/index.html'
    }),
    new MiniCSSExtractPlugin({
      filename: 'css/built.css'
    }),
    // å‹ç¼©css
    new OptimizeCSSAssetsWebpackPlugin()
  ],
  mode: 'development'
}

```

## 3. JSæ–‡ä»¶

### 3.1. JSè¯­æ³•æ£€æŸ¥eslint

#### ä½¿ç”¨çš„loaderï¼š`eslint-loader`

éœ€è¦ä¸‹è½½ï¼š

- `eslint-loader`å’Œ`eslint`ï¼šeslint-loaderæ˜¯åŸºäºeslintçš„ï¼ˆå¯ä»¥ç±»æ¯”ç†è§£ä¸ºï¼šjsä¸nodejsç¯å¢ƒçš„å…³ç³»ï¼‰;
  - å¯ä»¥åœ¨package.jsonä¸­å¢åŠ `eslintConfig`å­—æ®µï¼Œé…ç½®eslintã€‚æ¯”å¦‚å¯ä»¥åœ¨eslintConfigä¸­è®¾ç½®æ£€æŸ¥è§„åˆ™ï¼š`"eslintConfig": { "extends": "airbnb-base" }`ã€‚
- `eslint-config-airbnb-base`å’Œ`eslint-plugin-import`ï¼šå› æœ¬æ–‡ä¼šè®¾ç½®`airbnb-base`çš„æ£€æŸ¥è§„åˆ™æ¥è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œè€Œåˆ°`eslint-config-airbnb-base`å®˜ç½‘å¯ä»¥æŸ¥åˆ°è¿˜éœ€ä¸‹è½½`eslint-plugin-import`ã€‚

#### webpacké…ç½®

1ï¼‰å…ˆè¦åœ¨package.jsonä¸­é…ç½®å­—æ®µ`eslintConfig`ï¼š

```json
{
  "name": "webpack-study",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "eslintConfig": {
    "extends": "airbnb-base",
    "env": {
      "browser": true
    }
  }
}
```

2ï¼‰webpacké…ç½®ï¼š

```js
const { resolve } = require('path');
const HTMLWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build'),
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        loader: 'eslint-loader',
        options: {
          // è‡ªåŠ¨ä¿®å¤eslintçš„é”™è¯¯
          fix: true
        }
      }
    ],
  },
  plugins: [
    new HTMLWebpackPlugin({
      template: './src/index.html',
    }),
  ],
  mode: 'development',
};

```

### 3.2. JSå…¼å®¹æ€§å¤„ç†

1ï¼‰ä»€ä¹ˆæ˜¯JSå…¼å®¹æ€§å¤„ç†ï¼Ÿ  
å…¶å®å°±æ˜¯æŠŠES6åŠä»¥ä¸Šï¼ˆåè¾¹ç®€å†™ä¸ºES6+ï¼‰æ–°å¢çš„è¯­æ³•ã€APIå¤„ç†æˆES5åŠä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œè§£å†³æŸäº›æµè§ˆå™¨ï¼ˆieï¼‰ä¸Šçš„å…¼å®¹æ€§æŠ¥é”™é—®é¢˜ã€‚

2ï¼‰Babelç®€ä»‹ï¼š  
Babel æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºåœ¨å½“å‰å’Œæ—§çš„æµè§ˆå™¨æˆ–ç¯å¢ƒä¸­ï¼Œå°†ES6+ä»£ç è½¬æ¢ä¸ºJavaScriptå‘åå…¼å®¹ç‰ˆæœ¬çš„ä»£ç ã€‚

3ï¼‰polyfillæ˜¯å•¥ï¼Ÿ  
â‰ï¸ï¼šä¸çŸ¥é“å¤§å®¶ä¹‹å‰æœ‰æ²¡æœ‰è¿‡è¿™ç§ç–‘é—®ï¼šåªçŸ¥é“babelæ˜¯å¤„ç†ES6+å…¼å®¹çš„ï¼Œpolyfillåˆ†åˆ«æ˜¯å¹²å˜›çš„ğŸ˜µï¼Ÿ  
ğŸ…°ï¸ï¼šå…¶å®ï¼Œ`Babel`åªæ˜¯è½¬æ¢`syntax`å±‚è¯­æ³•ï¼Œæ‰€ä»¥éœ€è¦`@babel/polyfill`æ¥å¤„ç†APIå…¼å®¹,åˆå› ä¸º`polyfill`ä½“ç§¯å¤ªå¤§ï¼Œæ‰€ä»¥é€šè¿‡`preset`çš„`useBuiltIns`æ¥å®ç°æŒ‰éœ€åŠ è½½ã€‚å…·ä½“å¯ä»¥çœ‹[è¿™ç¯‡æ–‡ç« ](https://zhuanlan.zhihu.com/p/58624930)ã€‚

4ï¼‰è¯·å¤§å®¶è·Ÿæˆ‘ä¸€èµ·çœ‹ä¸€æ®µä»£ç ï¼ˆä¸‹é¢JSå…¼å®¹æ€§å¤„ç†ç›¸å…³å†…å®¹å°†ä»¥è¿™ä¸ªä½œä¸ºä¾‹å­ï¼‰ï¼š

  ```js
  const add = (x, y) => {
    return x + y;
  };
  console.log(add(2, 5));

  const promise = new Promise(resolve => {
    setTimeout(() => {
      console.log('å®šæ—¶å™¨æ‰§è¡Œå®Œäº†~');
      resolve();
    }, 1000);
  });

  console.log(promise);
  ```

  ä¸Šé¢ä»£ç å¦‚æœä¸åšä»»ä½•å…¼å®¹æ€§å¤„ç†ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š
  ieæ— æ³•è¯†åˆ«ES6+çš„å†…å®¹
  ![](https://gitee.com/ahuang6027/blog-images/raw/master/images/webpack-jså…¼å®¹1.png)

#### 3.2.1. å¤„ç†è¯­æ³•

##### 1ï¼‰ä¸‹è½½

- åŸºç¡€æ ¸å¿ƒåŒ…ï¼š`babel-loader`å’Œ`@babel/core`ï¼›
- å¤„ç†è¯­æ³•ï¼š`@babel/preset-env`ã€‚

##### 2ï¼‰webpacké…ç½®

```js
// ä»¥ä¸‹æ˜¯å•ä¸ªloaderé…ç½®
{
  test: /\.js$/,
  exclude: /node_modules/,
  loader: 'babel-loader',
  presets: [
    [
      '@babel/preset-env'
    ]
  ]
}
```

##### 3ï¼‰è¿è¡Œç»“æœ

IEä»ç„¶æ— æ³•è¯†åˆ«ES6+æ–°å¢çš„API
![](https://gitee.com/ahuang6027/blog-images/raw/master/images/webpack-jså…¼å®¹2.png)

#### 3.2.2. å¤„ç†è¯­æ³•+APIï¼ˆéæŒ‰éœ€åŠ è½½ï¼‰

##### 1ï¼‰ä¸‹è½½

- åŸºç¡€æ ¸å¿ƒåŒ…ï¼š`babel-loader`å’Œ`@babel/core`ï¼›
- å¤„ç†è¯­æ³•ï¼š`@babel/preset-env`;
- å¤„ç†APIï¼ˆç›´æ¥åœ¨jsä¸­å¼•å…¥ï¼‰ï¼š`@babel/polyfill`ã€‚

##### 2ï¼‰é…ç½®

webpack.config.jsï¼š

```js
// ä»¥ä¸‹æ˜¯å•ä¸ªloaderé…ç½®
{
  test: /\.js$/,
  exclude: /node_modules/,
  loader: 'babel-loader',
  presets: [
    [
      '@babel/preset-env'
    ]
  ]
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­æœ€é¡¶éƒ¨åŠ `import '@babel/polyfill';`ï¼š

```js
import '@babel/polyfill';

const add = (x, y) => {
  return x + y;
};
console.log(add(2, 5));

const promise = new Promise(resolve => {
  setTimeout(() => {
    console.log('å®šæ—¶å™¨æ‰§è¡Œå®Œäº†~');
    resolve();
  }, 1000);
});

console.log(promise);

```

##### 3ï¼‰è¿è¡Œç»“æœ

![](https://gitee.com/ahuang6027/blog-images/raw/master/images/webpack-jså…¼å®¹5.png)

##### 4) ç¼ºç‚¹

æˆ‘ä»¬æ¥çœ‹çœ‹æ‰“åŒ…åçš„ä»£ç ï¼š
![](https://gitee.com/ahuang6027/blog-images/raw/master/images/webpack-jså…¼å®¹4.png)

å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶è§£å†³äº†JSå…¼å®¹æ€§é—®é¢˜ï¼Œä½†è¿™ç§æ–¹æ³•å°†ES6+æ–°å¢çš„æ‰€æœ‰APIéƒ½æ‰“åŒ…è¿›æ¥äº†ï¼Œé€ æˆäº†ä»£ç çš„å†—ä½™ã€‚äº‹å®ä¸Šæˆ‘ä»¬åªéœ€è¦ç®­å¤´å‡½æ•°å’ŒPromiseçš„éƒ¨åˆ†==

#### 3.2.3. å¤„ç†è¯­æ³•+APIï¼ˆæŒ‰éœ€åŠ è½½ï¼‰

##### 1ï¼‰ä¸‹è½½

- åŸºç¡€æ ¸å¿ƒåŒ…ï¼š`babel-loader`å’Œ`@babel/core`ï¼›
- å¤„ç†è¯­æ³•å’ŒAPIï¼š`@babel/preset-env` + é…ç½®;
  - é…ç½®åŸºäºï¼š`core-js`ã€‚

##### 2ï¼‰webpacké…ç½®

æ³¨æ„ï¼šä¸éœ€è¦åœ¨jsä¸­`import @babel/polyfill`

```js
// ä»¥ä¸‹æ˜¯å•ä¸ªloaderé…ç½®
{
  test: /\.js$/,
  exclude: /node_modules/,
  loader: 'babel-loader',
  options: {
    // é¢„è®¾ï¼šæŒ‡ç¤ºbabelåšæ€ä¹ˆæ ·çš„å…¼å®¹æ€§å¤„ç†
    presets: [
      [
        '@babel/preset-env',
        {
          /** https://babeljs.io/docs/en/babel-preset-env#usebuiltins
           * useBuiltInsï¼šé…ç½®@babel/preset-envå¦‚ä½•å¤„ç†polyfillsï¼Œå–â€œusageâ€ï¼Œâ€œentryâ€ï¼Œâ€œfalseâ€ä¹‹ä¸€ï¼Œé»˜è®¤ä¸ºâ€œfalseâ€
           *  - å½“ä½¿ç”¨usageæˆ–entryé€‰é¡¹æ—¶ï¼Œ@babel/preset-envå°†æ·»åŠ å¯¹core-jsæ¨¡å—çš„ç›´æ¥å¼•ç”¨ï¼Œç±»ä¼¼importï¼ˆæˆ–requireï¼‰ã€‚è¿™æ„å‘³ç€core-jså°†ç›¸å¯¹äºæ–‡ä»¶æœ¬èº«è¿›è¡Œè§£æï¼Œå¹¶ä¸”æŒ‰éœ€å¼•å…¥ã€‚
           */
          useBuiltIns: 'usage', // æŒ‰éœ€åŠ è½½
          corejs: { version: 3 }, // æŒ‡å®šcorejsçš„ç‰ˆæœ¬
          targets: { chrome: '60', firefox: '60', ie: '9', safari: '10', edge: '17' } // æŒ‡å®šå…¼å®¹åˆ°æµè§ˆå™¨å“ªä¸ªç‰ˆæœ¬
        }
      ]
    ]
  }
}
```

##### 3ï¼‰è¿è¡Œç»“æœ

![](https://gitee.com/ahuang6027/blog-images/raw/master/images/webpack-jså…¼å®¹5.png)

### 3.3. å‹ç¼©JS

éå¸¸ç®€å•ï¼Œåªéœ€è¦æŠŠmodeè®¾ç½®ä¸ºâ€œproductionâ€ã€‚

åŸå› ï¼šâ€œproductionâ€ modeä¸‹ï¼Œwebpackä¼šè‡ªåŠ¨å¯ç”¨`TerserWebpackPlugin/UglifyJsPlugin`æ¥å‹ç¼©ã€‚

## 4. HTMLæ–‡ä»¶

HTMLæ–‡ä»¶ä¸åƒCSSå’ŒJSï¼Œä¸éœ€è¦åšå…¼å®¹æ€§å¤„ç†ã€‚

### 4.1. å‹ç¼©HTML

#### ä½¿ç”¨çš„pluginï¼š`html-webpack-plugin` + é…ç½®

#### webpacké…ç½®

```js
module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build')
  },
  plugins: [
    // htmlå‹ç¼©åªéœ€é…ç½®html-webpack-plugin
    new HTMLWebpackPlugin({
      template: './src/index.html',
      minify: {
        removeComments: true, // ç§»é™¤æ³¨é‡Š
        collapseWhitespace: true // ç§»é™¤ç©ºæ ¼
        // æ›´å¤šé…ç½®å¯ä»¥è‡ªè¡Œæ¢ç´¢ğŸ˜~
      }
    })
  ],
  mode: 'production'
}
```

## 5. æ€è€ƒå’Œæ€»ç»“

### 5.1. æ‹ä¸€æ‹

ğŸ¯æœ‰éƒ¨åˆ†èµ„æºçš„æ‰“åŒ…æ”¾åœ¨äº†ä¸Šä¸€æ¬¡[webpackå¼€å‘ç¯å¢ƒé…ç½®](https://www.yuque.com/otv29s/huanghuang/ylusyd)ä¸­ã€‚  
ä»æ–‡ä»¶ç±»å‹å‡ºå‘ï¼Œä¸€èµ·æ¥æ‹æ‹ğŸ‘‰

- å…ˆæ˜¯æ ·å¼ï¼ˆcss/less/sassï¼‰ï¼š
  - cssæ–‡ä»¶ï¼š
    - `postcss-loader`å¤„ç†csså…¼å®¹æ€§ï¼ˆè¿˜éœ€ä¸‹è½½`postcss-preset-env`ï¼Œåœ¨package.jsonä¸­é…ç½®`browserslist`å­—æ®µï¼‰ï¼›
    - `css-loader`å°†cssæ–‡ä»¶è½¬æ¢æˆcommonjsæ¨¡å—åŠ è½½åˆ°jsä¸­ï¼›
    - `mini-css-extract-plugin`å°†jsä¸­çš„cssæ¨¡å—æå–æˆå•ç‹¬çš„ä¸€ä¸ªæ–‡ä»¶ï¼›
    - `optimize-css-assets-webpack-plugin`å‹ç¼©cssï¼›
  - lessæ–‡ä»¶ï¼š
    - åœ¨cssæ–‡ä»¶çš„åŸºç¡€ä¸Šå¤šäº†`less-loader`ï¼ˆéœ€åœ¨å‹ç¼©å‰æ‰§è¡Œï¼Œè¿˜éœ€ä¸‹è½½`less`ï¼‰ï¼›
  - sassæ–‡ä»¶ï¼š
    - åœ¨cssæ–‡ä»¶çš„åŸºç¡€ä¸Šå¤šäº†`sass-loader`ï¼ˆéœ€åœ¨å‹ç¼©å‰æ‰§è¡Œï¼Œè¿˜éœ€ä¸‹è½½`node-sass`ï¼‰ï¼›
- å†æ˜¯jsæ–‡ä»¶ï¼š
  - `eslint-loader`åšè¯­æ³•æ£€æŸ¥ï¼ˆè¿˜éœ€ä¸‹è½½`eslint`ã€`eslint-config-airbnb-base`ã€`eslint-plugin-import eslint`ï¼Œåœ¨package.jsonä¸­é…ç½®`eslintConfig`å­—æ®µï¼‰
  - `babel-loader`å¤„ç†jså…¼å®¹æ€§ï¼š
    - `babel-loader`+`@babel/core`+`@babel/preset-env`ï¼šåªèƒ½å¤„ç†ES6+è¯­æ³•é—®é¢˜ï¼›
    - `babel-loader`+`@babel/core`+`@babel/preset-env`+ `@babel/polyfill`ï¼šä»¥éæŒ‰éœ€åŠ è½½çš„æ–¹å¼å¤„ç†jså…¨éƒ¨å…¼å®¹æ€§é—®é¢˜ï¼›
    - `babel-loader`+`@babel/core`+`@babel/preset-env`+ é…ç½®`presets`ï¼šä»¥æŒ‰éœ€åŠ è½½çš„æ–¹å¼å¤„ç†jså…¨éƒ¨å…¼å®¹æ€§é—®é¢˜ï¼ˆæ¨èï¼‰ï¼›
  - å°†modeè®¾ç½®ä¸º`production`ï¼Œè‡ªåŠ¨å‹ç¼©jsä»£ç ï¼›
- ç„¶åæ˜¯htmlæ–‡ä»¶ï¼š
  - `html-webpack-plugin`åˆ›å»ºä¸€ä¸ªç©ºçš„htmlå¹¶è‡ªåŠ¨å¼•å…¥æ‰€æœ‰webpackæ‰“åŒ…è¾“å‡ºçš„èµ„æºï¼›
    - å†å¯¹å…¶è¿›ä¸€æ­¥é…ç½®(`minify`)ï¼Œåšåˆ°å‹ç¼©htmlä»£ç ã€‚
- è¿˜æœ‰å›¾ç‰‡èµ„æºï¼š
  - `url-loader`å¤„ç†cssä¸­çš„å›¾ç‰‡èµ„æºï¼ˆèƒŒæ™¯å›¾ç‰‡ç­‰ï¼Œimgæ ‡ç­¾é™¤å¤–ï¼‰ï¼ˆè¿˜éœ€ä¸‹è½½`file-loader`ï¼‰ï¼›
  - é’ˆå¯¹imgæ ‡ç­¾ï¼š`html-loader`å¤„ç†htmlæ–‡ä»¶çš„imgå›¾ç‰‡ï¼Œä»è€Œèƒ½è¢«url-loaderå¤„ç†ï¼›
- æœ€åå…¶ä»–èµ„æºï¼š`file-loader`

### 5.2. æ€»çš„webpacké…ç½®

è·Ÿç€æ‹å‡ºæ¥çš„æ€è·¯ï¼Œå¯ä»¥å†™ä¸€ä¸‹~

```js
const { resolve } = require('path');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const HTMLWebpackPlugin = require('html-webpack-plugin');
const OptimizeCssAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin');

process.env.NODE_ENV = 'production'; // å®šä¹‰nodejsç¯å¢ƒå˜é‡ï¼šå†³å®šä½¿ç”¨browserslistçš„å“ªä¸ªç¯å¢ƒ

const commonCssLoader = [
  MiniCssExtractPlugin.loader,
  // 'style-loader', // ç›´æ¥å°†cssæ”¾åˆ°styleæ ‡ç­¾é‡Œ
  'css-loader',
  {
    loader: 'postcss-loader',
    options: {
      postcssOptions: {
        ident: 'post-css',
        plugins: [ 'postcss-preset-env' ] // è¿˜éœ€è¦åœ¨package.jsonä¸­é…ç½®browserslist
      }
    }
  }
];

module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build')
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [...commonCssLoader]
      },
      {
        test: /\.less$/,
        use: [ ...commonCssLoader, 'less-loader' ]
      },
      /**
       * æ³¨æ„ï¼šæ­£å¸¸æ¥è®²ï¼Œä¸€ä¸ªæ–‡ä»¶åªèƒ½ç”±ä¸€ä¸ªloaderå¤„ç†ã€‚
       * å½“ä¸€ä¸ªæ–‡ä»¶è¦è¢«å¤šä¸ªloaderå¤„ç†ï¼Œéœ€è¦æŒ‡å®šloaderæ‰§è¡Œçš„å…ˆåé¡ºåºã€‚
       * è¿™é‡Œï¼šåº”å…ˆæ‰§è¡Œeslint-loaderï¼Œå†æ‰§è¡Œbabel-loader
       */
      {
        // éœ€è¦åœ¨package.jsonä¸­é…ç½®eslintConfig
        test: /\.js$/,
        exclude: /node_modules/,
        enforce: 'pre', // ä¼˜å…ˆæ‰§è¡Œ
        loader: 'eslint-loader',
        options: {
          fix: true
        }
      },
      {
        test: /\.js$/,
        exclude: /node_modules/,
        loader: 'babel-loader',
        options: {
          presets: [
            [
              '@babel/preset-env',
              {
                useBuiltIns: 'usage',
                corejs: { version: 3 },
                targets: {
                  chrome: '60',
                  firefox: '50',
                  ie: '9'
                }
              }
            ]
          ]
        }
      },
      {
        test: /\.(jpg|png|gif)$/,
        loader: 'url-loader',
        options: {
          limit: 8 * 1024,
          name: '[hash:10].[ext]',
          outputPath: 'images',
          esModule: false
        }
      },
      {
        test: /\.html$/,
        loader: 'html-loader',
        options: {
          esModule: false
        }
      },
      {
        exclude: /\.(js|html|css|less|jpg|png|gif)$/,
        loader: 'file-loader',
        options: {
          outputPath: 'assets'
        }
      }
    ]
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'css/built.css'
    }),
    new OptimizeCssAssetsWebpackPlugin(),
    new HTMLWebpackPlugin({
      template: './src/index.html',
      minify: {
        removeComments: true,
        collapseWhitespace: true
      }
    })
  ],
  mode: 'production'
}
```
